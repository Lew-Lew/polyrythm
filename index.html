<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #f0f0f0;
      }

      #container {
        width: 100%;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .rectangle {
        width: 70%;
        height: 80%;
        background-color: transparent;
        position: relative;
        border-top: 1px solid black;
        border-bottom: 1px solid black;
      }

      .square {
        width: 50px;
        background-color: #55a0dd6e;
        border: 1px solid #0074d9;
        position: absolute;
      }

      .square.active {
        transform: scale(1.1);
        border: 2px solid #0074d9;
        box-shadow: 0 0 1rem #0074d9;
      }

      #play-button {
        top: 10px;
        left: 10px;
        background-color: #0074d9;
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <button id="play-button">Play</button>

    <div id="container">
      <div class="rectangle">
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
        <div class="square"></div>
      </div>
    </div>

    <audio src="assets/f4.mp3"></audio>
    <audio src="assets/g4.mp3"></audio>
    <audio src="assets/a4.mp3"></audio>
    <audio src="assets/c5.mp3"></audio>
    <audio src="assets/f5.mp3"></audio>
    <audio src="assets/g5.mp3"></audio>
    <audio src="assets/a5.mp3"></audio>
    <audio src="assets/c6.mp3"></audio>

    <script>
      const audioElements = document.querySelectorAll("audio");

      const squares = document.querySelectorAll(".square");
      const rectangle = document.querySelector(".rectangle");
      const playButton = document.getElementById("play-button");

      const squareData = [];

      const keyLen = squares.length;
      const squareSize = squares[0].offsetWidth;
      const availableWidth = rectangle.offsetWidth - keyLen * squareSize;
      const spacing = availableWidth / (keyLen - 1);
      const minHeight = squareSize * 2;

      for (let i = 0; i < keyLen; i++) {
        const x = i * (squareSize + spacing);
        const y = 0;

        squareData.push({
          element: squares[i],
          x,
          y,
          height: minHeight + ((keyLen - i - 1) / (keyLen - 1)) * minHeight,
          speedY: 5,
          directionY: 1,
        });

        squares[i].style.height = squareData[i].height + "px";
        squares[i].style.transform = `translate(${x}px, ${y}px)`;
      }

      let animationId = null;

      function animate() {
        for (const [index, square] of squareData.entries()) {
          square.y += square.speedY * square.directionY;

          if (square.y < 0) {
            square.y = 0;
            square.directionY = 1;
          } else if (square.y > rectangle.offsetHeight - square.height) {
            square.y = rectangle.offsetHeight - square.height;
            square.directionY = -1;

            const audioElement = audioElements[index];
            audioElement.currentTime = 0;
            audioElement.play();

            square.element.classList.add("active");

            setTimeout(() => {
              square.element.classList.remove("active");
            }, 700);
          }

          square.element.style.transform = `translate(${square.x}px, ${square.y}px)`;
        }

        animationId = requestAnimationFrame(animate);
      }

      function stopAnimation() {
        cancelAnimationFrame(animationId);
        animationId = null;

        for (const square of squareData) {
          square.y = 0;
          square.element.style.transform = `translate(${square.x}px, ${square.y}px)`;
        }
      }

      playButton.addEventListener("click", () => {
        if (animationId === null) {
          animate();
          playButton.textContent = "Stop";
        } else {
          stopAnimation();
          playButton.textContent = "Play";
        }
      });
    </script>
  </body>
</html>
